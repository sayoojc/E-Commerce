<!DOCTYPE html>
<html lang="en">

<head>
   <!-- Basic -->
   <meta charset="utf-8" />
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <!-- Mobile Metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
   <!-- Site Metas -->
   <meta name="keywords" content="" />
   <meta name="description" content="" />
   <meta name="author" content="" />
   <link rel="shortcut icon" href="images/favicon.png" type="">
   <title>Famms - Fashion HTML Template</title>
   <link rel="stylesheet" type="text/css" href="/user/css/bootstrap.css" />
   <!-- font awesome style -->
   <link href="/user/css/font-awesome.min.css" rel="stylesheet" />
   <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
   <!-- responsive style -->
   <link href="/user/css/responsive.css" rel="stylesheet" />
   <!-- Custom styles for this template -->
   <link href="/user/css/style.css" rel="stylesheet" />
   <link rel="stylesheet" href="/user/css/my-style.css">
   <link href="https://use.fontawesome.com/releases/v5.0.1/css/all.css" rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <style>
      .box {
         border: 1px solid #ddd;
         padding: 15px;
         margin: 10px 0;
         text-align: center;
         height: 100%;
         display: flex;
         flex-direction: column;
         justify-content: space-between;
      }

      .box .img-box img {
         max-width: 100%;
         height: auto;
      }

      .box .detail-box {
         margin-top: 10px;
      }

      .box .option_container {
         display: none;
      }

      .box:hover .option_container {
         display: block;
      }

      .filters {
         background-color: #f8f9fa;
         padding: 15px;
         border-radius: 5px;
         margin-left: 15px;
      }

      .filters .list-group-item {
         border: none;
         padding: 10px 0;
      }

      .filters .dropdown-toggle {
         width: 100%;
      }

      .heart-container {
         position: absolute;
         top: 10px;
         /* Adjust as needed */
         right: 20px;
         /* Adjust as needed */
         width: 20px;
         /* Width of the heart */
         height: 20px;
         /* Height of the heart */
         z-index:1;
      }

      .heart {
         position: absolute;
         top: 30px;
         left: 0;
         right: 20px;
         width: 20px;
         /* Adjust the width */
         height: 20px;
         /* Adjust the height */
         transition: transform 0.2s;
      }

      .heart:hover {
         transform: scale(1.1);
         cursor: pointer;
      }



      /* Custom styles for the dropdown */
      .dropdown-menu.category-list {
         background-color: #e9ecef;
         /* Adjusted light background color */
         border: 1px solid #6c757d;
         /* Match button color */
      }

      .dropdown-menu .dropdown-item {
         color: #212529;
         /* Adjusted dark color for text */
      }

      .dropdown-menu .dropdown-item:hover {
         background-color: #6c757d;
         /* Bootstrap secondary color */
         color: #ffffff;
         /* Adjusted text color for hover */
      }

      .dropdown-item-text.text-muted {
         color: #6c757d;
         /* Adjusted secondary color */
      }
      a {
    text-decoration: none; /* Remove underline */
    color: inherit; /* Inherit text color from parent */
  }

  a:hover {
    text-decoration: none; /* Ensure underline is not added on hover */
  }

  a h5, a h6 {
    color: inherit; /* Ensure text color does not change */
    text-decoration: none; /* Ensure no underline is added */
    margin: 0; /* Remove any default margin if needed */
  }

  a h5:hover, a h6:hover {
    color: inherit; /* Ensure text color does not change on hover */
    text-decoration: none; /* Ensure no underline is added on hover */
  }
  footer {
    background: #f8f8f8;
    padding: 40px 0 0px;
    margin-top: 50px;
}


#accountModal{
   z-index: 5000!important ;
}
   </style>

</head>

<body class="sub_page">
   <div class="hero_area">
      <!-- header section strats -->
      <style>
         /* Style for the icon */
         .cart-icon {
            color: #000000;
            /* Change to your desired icon color;*/
            height: 50px;
         }
      </style>

<style>


   /* Style for the icon */
   .cart-icon {
     color: #131313; /* Change to your desired icon color;*/
     height: 20px;
   }
   .nav-item .form-inline {
               width: 100%;
           }
   
           .input-group {
               width: 100%;
           }
   
           .form-control {
           
               border-radius: 10px 0 0 10px;
               border-color: #6c757d;
           }
   
           .btn-outline-secondary {
               border-radius: 0 10px 10px 0;
               border-color: #6c757d;
               color: #6c757d;
           }
   
           .btn-outline-secondary:hover {
               background-color: #6c757d;
               color: white;
           }
   
           .fa-search {
               margin-right: 0;
           }
   
           .cart-button {
               position: relative;
           }
   
           .cart-icon {
               font-size: 1.2em;
             margin-right: 50px;
           }
   
           .cart-icon-badge {
               position: absolute;
               top: -3px;
               right: 5px;
               background: red;
               color: white;
               border-radius: 50%;
               padding: 0.2em 0.5em;
               font-size: 0.5em;
           }
           .product-card {
               border: 1px solid #eaeaea;
               border-radius: 5px;
               padding: 15px;
               text-align: center;
               margin: 10px;
               transition: box-shadow 0.3s;
           }
           .product-card:hover {
               box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
           }
           .product-card img {
               max-width: 100%;
               height: auto;
           }
           .product-price {
               font-size: 1.2em;
               color: #007bff;
           }
           .product-price del {
               color: #999;
               margin-left: 10px;
           }
           .product-discount {
               background: green;
               color: white;
               font-size: 0.85em;
               padding: 2px 8px;
               position: absolute;
               top: 10px;
               left: 10px;
               border-radius: 3px;
           }
           .bold-montserrat {
         font-family: 'Montserrat', sans-serif;
      
       }

       .header_section{
         position: fixed !important;
         width: 100%;
      
       }
   </style>
   
   <header class="header_section">
     <div id="modalBackground"></div> 
       <div class="container">
          <nav class="navbar navbar-expand-lg custom_nav-container">
             <a class="navbar-brand" style="position: fixed;" href="/getHome"> <h4 class="bold-montserrat">NUTROMAX</h4></a>
             <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                 <span class=""> </span>
             </button>
             <div class="collapse navbar-collapse" id="navbarSupportedContent">
                 <ul class="navbar-nav">
                   
             <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav">
                   <li class="nav-item active">
                     <a class="nav-link" href="/getHome">Home <span class="sr-only">(current)</span></a>
                   </li>
                  
                   <li class="nav-item">
                     <a class="nav-link" href="/product-list/:action">Products</a>
                   </li>
                 
                  
                    <!-- Account modal trigger -->
                    <li class="nav-item">
                      <a class="nav-link" href="#" id="accountModalTrigger">Account</a>
                  </li>
                  
                  
                  
                  <li class="nav-item">
                   <form class="form-inline" action="/getCart">
                       <button class="btn my-2 my-sm-0 nav_search-btn cart-button" type="submit"> 
                           <i class="fas fa-shopping-cart cart-icon"></i>
                           <span class="cart-icon-badge"><%= number %></span>
                       </button>
                   </form>
               </li>
                 </ul>
                 
                   
                 
                 <li class="nav-item">
                   <form class="form-inline" action="/product-list/search" method="GET">
                     <div class="input-group">
                       <input type="text" class="form-control" name="search" placeholder="Search" aria-label="Search" required style="width: 300px;">
                       <button class="btn btn-outline-secondary" type="submit">
                         <i class="fa fa-search"></i>
                       </button>
                     </div>
                   </form>
                 </li>
                </ul>
             </div>
          </nav>
       </div>
       <!-- Account Modal HTML structure -->
   <div class="modal custom-modal modal-sm" id="accountModal" style="top: 0px; left:1000px; width: 180px;">
     <div class="modal-dialog">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title">Account</h5>
                 <div class="close-btn">&times;</div>
             </div>
             <div class="modal-body">
                <ul style="list-style-type: none; justify-content: center; padding-left: 0;">
                 <li style="margin-top: 5px;"><a href="/getOrderHistory">My orders</a></li>
                 <li style="margin-top: 5px;"><a href="/getProfile">My Profile</a></li>
                 <li style="margin-top: 5px;"><a href="">My Addresses</a></li>
                 <li style="margin-top: 5px;"><a href="/getWishlist">Wishlist</a></li>
                 <li style="margin-top: 5px;"><a href="/getWallet">Wallet</a></li>
                 <li style="margin-top: 5px;"><a href="/getCoupons">Coupons</a></li>
                 <li style="margin-top: 5px;"><form action="/postLogout" method="post"><button type="submit" style="border: none; background-color: white;padding: 5px  ;">Logout</button></form></li>
                </ul>
             </div>
         </div>
     </div>
   </div>
   
   
   

   
    </header>
   

      <!-- end header section -->
   </div>
   <!-- inner page section -->
   <section class="inner_page_head" >
      <div class="container_fuild" style="margin-top: 50px;">
         <div class="row">
            <div class="col-md-12">
               <div class="full">
                  <h3>Product Grid</h3>
               </div>
            </div>
         </div>
      </div>
   </section>

   
   <!-- product section -->
   <section class="product_section layout_padding"style="background-color:#f0f0f0;">
      <div class="container-fluid">
         <div class="row">
            <!-- Filters section -->
            <div class="col-lg-2 col-md-3 col-sm-12">
               
               <div class="filters">
                  <h5>FILTERS</h5>
                  <ul class="list-group mb-4">
                     <li class="list-group-item list-group-item-dark">CATEGORIES</li>
                     <div class="dropdown mb-2">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false" data-bs-display="static">
                            <% 
                                // Find the selected category safely
                                let selectedCategory = categories.find(cat => cat._id.toString() === category.toString());
                            %>
                            <% if (selectedCategory) { %>
                                <%= selectedCategory.categoryName %>
                            <% } else { %>
                                Select category
                            <% } %>
                        </button>
                        <ul class="dropdown-menu category-list">
                            <% categories.forEach(cat => { %>
                                <% if (cat._id.toString() === category) { %>
                                    <li>
                                        <span class="dropdown-item-text text-muted">
                                            <%= cat.categoryName %>
                                        </span>
                                    </li>
                                <% } else { %>
                                    <li>
                                        <a class="dropdown-item"
                                           href="/product-list/list?category=<%= cat._id %><% if (search) { %>&search=<%= search %><% } %>">
                                            <%= cat.categoryName %>
                                        </a>
                                    </li>
                                <% } %>
                            <% }) %>
                        </ul>
                    </div>
                    

                     <li class="list-group-item"><a
                           href="/product-list/lowToHigh<% if (category || search) { %>?<% } %><% if (category) { %>category=<%= category %><% } %><% if (category && search) { %>&<% } %><% if (search) { %>search=<%= search %><% } %>">Price:
                           low to high</a></li>
                     <li class="list-group-item"><a
                           href="/product-list/highToLow<% if (category || search) { %>?<% } %><% if (category) { %>category=<%= category %><% } %><% if (category && search) { %>&<% } %><% if (search) { %>search=<%= search %><% } %>">Price:
                           high to low</a></li>
                     <li class="list-group-item"><a
                           href="/product-list/newArrivals<% if (category || search) { %>?<% } %><% if (category) { %>category=<%= category %><% } %><% if (category && search) { %>&<% } %><% if (search) { %>search=<%= search %><% } %>">New
                           Arrivals</a></li>
                     <li class="list-group-item"><a
                           href="/product-list/aA-Zz<% if (category || search) { %>?<% } %><% if (category) { %>category=<%= category %><% } %><% if (category && search) { %>&<% } %><% if (search) { %>search=<%= search %><% } %>">aA-Zz</a>
                     </li>
                     <li class="list-group-item"><a
                           href="/product-list/Zz-aA<% if (category || search) { %>?<% } %><% if (category) { %>category=<%= category %><% } %><% if (category && search) { %>&<% } %><% if (search) { %>search=<%= search %><% } %>">Zz-aA</a>
                     </li>
                     <li class="list-group-item"><a
                           href="/product-list/stock<% if (category || search) { %>?<% } %><% if (category) { %>category=<%= category %><% } %><% if (category && search) { %>&<% } %><% if (search) { %>search=<%= search %><% } %>">Stock</a>
                     </li>
                  </ul>
               </div>
            </div>
            <!-- Products section -->
            <div class="col-lg-10 col-md-9 col-sm-12" >
               <div class="row" style="background-color: none;">
                  <% products.forEach(product => { %>
                     <div class="col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch" style="margin-top: 30px; position: relative; background-color:transparent;">
                        <div class="heart-container" data-productid="<%= product._id %>" style="width: 35px; background-color: none;">
                           <% let isInWishlist = wishlist && Array.isArray(wishlist.products) && wishlist.products.some(wp => wp.product_id.equals(product._id)); %>
                           <% if (isInWishlist) { %>
                              <img src="/user/images/heart red.png" alt="Red Heart" class="heart heart-red" style="width: 23px; height: 23px; display: block;">
                              <img src="/user/images/heart transparent.png" alt="Transparent Heart" class="heart heart-transparent" style="width: 23px; height: 23px; display: none;">
                           <% } else { %>
                              <img src="/user/images/heart transparent.png" alt="Transparent Heart" class="heart heart-transparent" style="width: 23px; height: 23px; display: block;">
                              <img src="/user/images/heart red.png" alt="Red Heart" class="heart heart-red" style="width: 23px; height: 23px; display: none;">
                           <% } %>
                        </div>
                        <a href="/getProductDetail/<%= product._id %>" style="background-color: transparent;">
                           <div class="box" style="width: 300px; height:400px; background-color: #ffffff;">
                              <div class="img-box">
                                 <img src="/<%= product.image[0] %>" alt="<%= product.productName %>">
                              </div>
                              <div class="detail-box">
                                 <h5><%= product.productName %></h5>
                                 <h6>â‚¹<%= product.price %>/-</h6>
                              </div>
                           </div>
                        </a>
                     </div>
                  <% }); %>
               </div>
               



               <div class="btn-box text-center mt-4">
                  <a href="">View All products</a>
               </div>
               <div class="pagination mt-4">
                  <ul class="pagination justify-content-center">
                     <% if(currentPage!==1 && previousPage!=1){ %>
                        <li class="page-item"><a class="page-link"
                              href="/product-list/<%= action %>?<% if (category && search) { %>category=<%= category %>&search=<%= search %>&<% } else if(category) { %>category=<%= category %>&<% } else if(search) { %>search=<%= search %>&<% } %>page=1">1</a>
                        </li>
                        <% } %>
                           <% if(hasPreviousPage){ %>
                              <li class="page-item"><a class="page-link"
                                    href="/product-list/<%= action %>?<% if (category && search) { %>category=<%= category %>&search=<%= search %>&<% } else if(category) { %>category=<%= category %>&<% } else if(search) { %>search=<%= search %>&<% } %>page=<%= previousPage %>">
                                    <%= previousPage %>
                                 </a></li>
                              <% } %>
                                 <li class="page-item active"><a class="page-link"
                                       href="/product-list/<%= action %>?<% if (category && search) { %>category=<%= category %>&search=<%= search %>&<% } else if(category) { %>category=<%= category %>&<% } else if(search) { %>search=<%= search %>&<% } %>page=<%= currentPage %>">
                                       <%= currentPage %>
                                    </a></li>
                                 <% if(hasNextPage){ %>
                                    <li class="page-item"><a class="page-link"
                                          href="/product-list/<%= action %>?<% if (category && search) { %>category=<%= category %>&search=<%= search %>&<% } else if(category) { %>category=<%= category %>&<% } else if(search) { %>search=<%= search %>&<% } %>page=<%= nextPage %>">
                                          <%= nextPage %>
                                       </a></li>
                                    <% } %>
                                       <% if(lastPage!==currentPage && nextPage!==lastPage){ %>
                                          <li class="page-item"><a class="page-link"
                                                href="/product-list/<%= action %>?<% if (category && search) { %>category=<%= category %>&search=<%= search %>&<% } else if(category) { %>category=<%= category %>&<% } else if(search) { %>search=<%= search %>&<% } %>page=<%= lastPage %>">
                                                <%= lastPage %>
                                             </a></li>
                                          <% } %>
                  </ul>
               </div>
            </div>
         </div>
      </div>
   </section>




   <!-- end product section -->
   <!-- footer section -->
   <%-include('./footer.ejs')%>


    

   <script>
      document.addEventListener('DOMContentLoaded', function () {
         var accountModalTrigger = document.getElementById('accountModalTrigger');
         var accountModal = document.getElementById('accountModal');
         let modalBackground = document.getElementById('modalBackground');

         accountModalTrigger.addEventListener('click', function (event) {
            event.preventDefault();
            modalBackground.style.display = 'block';
            accountModal.style.display = 'block';
         });

         // Close the modal when the close button is clicked
         var closeModalButton = accountModal.querySelector('.close-btn');
         closeModalButton.addEventListener('click', function () {
            accountModal.style.display = 'none';
            modalBackground.style.display = 'none';
         });

         // Close the modal when clicking outside the modal
         modalBackground.addEventListener('click', function (event) {
            accountModal.style.display = 'none';
            modalBackground.style.display = 'none';
         });
      });
   </script>



      <script>
    document.addEventListener('DOMContentLoaded', function () {
   // Select all transparent heart images
   const transparentHearts = document.querySelectorAll('.heart-transparent');
   // Select all red heart images
   const redHearts = document.querySelectorAll('.heart-red');

   // Function to toggle hearts
   const toggleHearts = (heartToHide, heartToShow) => {
      console.log(`Toggling hearts: hiding ${heartToHide.className}, showing ${heartToShow.className}`);
      heartToHide.style.display = 'none';
      heartToShow.style.display = 'block';
   };

   // Add to wishlist
   transparentHearts.forEach(heart => {
      const productId = heart.closest('.heart-container').getAttribute('data-productid');
      heart.addEventListener('click', async function () {
         try {
            const response = await fetch(`/addToWishlist/${productId}`, {
               method: 'POST'
            });
            if (!response.ok) {
               throw new Error('Server error');
            }
            // Toggle hearts
            const redHeart = heart.closest('.heart-container').querySelector('.heart-red');
            if (redHeart) {
               toggleHearts(heart, redHeart);
            } else {
               console.error('Red heart element not found');
            }
         } catch (error) {
            console.error(error);
         }
      });
   });

   // Remove from wishlist
   redHearts.forEach(heart => {
      const productId = heart.closest('.heart-container').getAttribute('data-productid');
      heart.addEventListener('click', async function () {
         try {
            const response = await fetch(`/removeFromWishlist`, {
               method: 'DELETE',
               headers: {
                  'Content-Type': 'application/json'
               },
               body: JSON.stringify({ productId: productId })
            });
            if (!response.ok) {
               throw new Error('Server error');
            }
            // Toggle hearts
            const transparentHeart = heart.closest('.heart-container').querySelector('.heart-transparent');
            if (transparentHeart) {
               toggleHearts(heart, transparentHeart);
            } else {
               console.error('Transparent heart element not found');
            }
         } catch (error) {
            console.error(error);
         }
      });
   });
});

      </script>
      <!-- footer section -->
      <!-- bootstrap -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
         integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
         crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

      <!-- jQery -->

      <script src="/user/js/jquery-3.4.1.min.js"></script>
      <!-- popper js -->
      <script src="/user/js/popper.min.js"></script>
      <!-- bootstrap js -->
      <script src="/user/js/bootstrap.js"></script>
      <!-- custom js -->
      <script src="/user/js/custom.js"></script>
</body>

</html>